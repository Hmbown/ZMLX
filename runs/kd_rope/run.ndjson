{"candidate_id": "rope_81f50de3ebb400a3", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.5}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg512_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 512}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.068667, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.3621053065419413, "latency_us": 162.64600000000002, "p10_us": 148.542, "p90_us": 279.375, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.15163755101068882, "latency_us": 167.9795, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 159.625, "p90_us": 293.125, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.366360180855402}, {"baseline_us": 221.64600000000002, "gbps_est": 0.26440845528455287, "latency_us": 192.1875, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 155.75, "p90_us": 279.375, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.15328}, {"baseline_us": 228.042, "gbps_est": 0.6702699133305821, "latency_us": 151.4375, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 140.458, "p90_us": 159.542, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5058489475856376}], "reference_latency_us": 226.41649999999998, "speedup_vs_ref": 1.3920815759379264}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_da5cfefdaee0904b", "seed": 0, "status": "benchmarked", "step": 0, "template_params": {"use_fma": true}, "ts": "2026-02-09T18:48:13-0600"}
{"candidate_id": "rope_da5cfefdaee0904b", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.25}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg256_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 256}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.041625, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.349382690587465, "latency_us": 157.91649999999998, "p10_us": 125.292, "p90_us": 252.083, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.18294973407216145, "latency_us": 139.2295, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 122.958, "p90_us": 252.083, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6485048068117747}, {"baseline_us": 221.64600000000002, "gbps_est": 0.32179031323515916, "latency_us": 157.91649999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 148.167, "p90_us": 225.042, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.403564542020625}, {"baseline_us": 228.042, "gbps_est": 0.5434080244550743, "latency_us": 186.79149999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 138.625, "p90_us": 247.667, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.2208371365934747}], "reference_latency_us": 228.042, "speedup_vs_ref": 1.4440669594374242}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": null, "seed": 0, "status": "benchmarked", "step": 0, "template_params": {"use_fma": false}, "ts": "2026-02-09T18:48:13-0600"}
{"candidate_id": "rope_faa2cc8c9f591b70", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.125}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg128_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 128}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.043125, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.3954729550510536, "latency_us": 143.291, "p10_us": 129.292, "p90_us": 236.375, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.1818889400641953, "latency_us": 140.04149999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 135.417, "p90_us": 165.416, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.638946312343127}, {"baseline_us": 221.64600000000002, "gbps_est": 0.3749677171803631, "latency_us": 135.52100000000002, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 116.167, "p90_us": 250.125, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6355103637074697}, {"baseline_us": 228.042, "gbps_est": 0.6295622079086024, "latency_us": 161.2295, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 129.292, "p90_us": 203.541, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.4143937678898713}], "reference_latency_us": 228.042, "speedup_vs_ref": 1.5914607337515965}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_da5cfefdaee0904b", "seed": 0, "status": "benchmarked", "step": 0, "template_params": {"use_fma": true}, "ts": "2026-02-09T18:48:13-0600"}
{"candidate_id": "rope_d8bd5f5b96766e89", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.125}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg128_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 128}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.035792, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.4259104767936348, "latency_us": 140.33350000000002, "p10_us": 128.333, "p90_us": 180.708, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.1937653090720991, "latency_us": 131.458, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 127.416, "p90_us": 235.042, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.745960687063549}, {"baseline_us": 221.64600000000002, "gbps_est": 0.36130426745161603, "latency_us": 140.64600000000002, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 131.291, "p90_us": 143.75, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.575913996843138}, {"baseline_us": 228.042, "gbps_est": 0.7226618538571892, "latency_us": 140.45850000000002, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 134.333, "p90_us": 145.042, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6235542882773202}], "reference_latency_us": 228.042, "speedup_vs_ref": 1.6250004453676419}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_faa2cc8c9f591b70", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": false}, "ts": "2026-02-09T18:48:13-0600"}
{"candidate_id": "rope_5e49a0eb05882163", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.5}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg512_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 512}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.041458, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.44687779884019335, "latency_us": 133.8755, "p10_us": 127.25, "p90_us": 159.458, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.18226833631484798, "latency_us": 139.75, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 125.0, "p90_us": 154.125, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6423649373881932}, {"baseline_us": 221.64600000000002, "gbps_est": 0.3831555136663526, "latency_us": 132.625, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 126.833, "p90_us": 175.084, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6712233741753064}, {"baseline_us": 228.042, "gbps_est": 0.7752095465393795, "latency_us": 130.9375, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 127.25, "p90_us": 141.042, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.7416095465393795}], "reference_latency_us": 228.042, "speedup_vs_ref": 1.7033885961210231}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_81f50de3ebb400a3", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": false}, "ts": "2026-02-09T18:48:13-0600"}
{"candidate_id": "rope_8e6b355277070755", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.0625}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg64_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 64}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.038292, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.4015294773246337, "latency_us": 144.1045, "p10_us": 126.042, "p90_us": 278.208, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.13985998627316404, "latency_us": 182.125, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 127.667, "p90_us": 300.042, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.2602361015785861}, {"baseline_us": 221.64600000000002, "gbps_est": 0.3984927913551155, "latency_us": 127.5205, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 125.625, "p90_us": 146.917, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.7381205374822088}, {"baseline_us": 228.042, "gbps_est": 0.6662356543456216, "latency_us": 152.3545, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 125.666, "p90_us": 262.375, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.4967854576005304}], "reference_latency_us": 228.042, "speedup_vs_ref": 1.5824766055189117}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_faa2cc8c9f591b70", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": false}, "ts": "2026-02-09T18:48:14-0600"}
{"candidate_id": "rope_c73769625b5efd6b", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.25}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg256_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 256}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.035917, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.4550287957421097, "latency_us": 130.45850000000002, "p10_us": 127.166, "p90_us": 141.125, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.1952812649736464, "latency_us": 130.4375, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 127.917, "p90_us": 141.125, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.7596205079060854}, {"baseline_us": 221.64600000000002, "gbps_est": 0.37898913359635455, "latency_us": 134.083, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 130.042, "p90_us": 173.833, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.653050722313791}, {"baseline_us": 228.042, "gbps_est": 0.790815988656328, "latency_us": 128.3535, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 126.708, "p90_us": 130.458, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.776671458121516}], "reference_latency_us": 228.042, "speedup_vs_ref": 1.7480041545778924}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_da5cfefdaee0904b", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": true}, "ts": "2026-02-09T18:48:14-0600"}
{"candidate_id": "rope_981b7e3c51434fe4", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.0625}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg64_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 64}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.045084, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.4126436220955378, "latency_us": 139.83350000000002, "p10_us": 128.083, "p90_us": 190.292, "per_shape": [{"baseline_us": 229.5205, "gbps_est": 0.1925444945442451, "latency_us": 132.29149999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 125.041, "p90_us": 136.708, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.7349602960129715}, {"baseline_us": 221.64600000000002, "gbps_est": 0.36519914334583814, "latency_us": 139.14600000000002, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 133.958, "p90_us": 141.833, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5929024190418697}, {"baseline_us": 228.042, "gbps_est": 0.6801872283965301, "latency_us": 149.2295, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 145.417, "p90_us": 244.625, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5281294918229975}], "reference_latency_us": 228.042, "speedup_vs_ref": 1.6308109287116461}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_d8bd5f5b96766e89", "seed": 0, "status": "benchmarked", "step": 2, "template_params": {"use_fma": true}, "ts": "2026-02-09T18:48:14-0600"}
