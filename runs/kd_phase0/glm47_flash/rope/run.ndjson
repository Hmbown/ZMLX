{"candidate_id": "rope_81f50de3ebb400a3", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.5}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg512_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 512}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.051417, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.388624621995545, "latency_us": 152.0625, "p10_us": 142.958, "p90_us": 188.333, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.1632166599919904, "latency_us": 156.0625, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 142.25, "p90_us": 208.084, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.475770925110132}, {"baseline_us": 211.52100000000002, "gbps_est": 0.33523437577308873, "latency_us": 151.58350000000002, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 141.459, "p90_us": 167.667, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.3954091309410324}, {"baseline_us": 205.39600000000002, "gbps_est": 0.6674228302215559, "latency_us": 152.08350000000002, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 148.916, "p90_us": 158.458, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.3505475610437687}], "reference_latency_us": 211.60399999999998, "speedup_vs_ref": 1.3915593916974927}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_da5cfefdaee0904b", "seed": 0, "status": "benchmarked", "step": 0, "template_params": {"use_fma": true}, "ts": "2026-02-09T19:12:14-0600"}
{"candidate_id": "rope_da5cfefdaee0904b", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.25}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg256_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 256}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.038833, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.40554217203373516, "latency_us": 144.542, "p10_us": 126.583, "p90_us": 175.209, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.1814031826744008, "latency_us": 140.41649999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 137.125, "p90_us": 175.209, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6402096619699253}, {"baseline_us": 211.52100000000002, "gbps_est": 0.36356741944830995, "latency_us": 139.7705, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 119.625, "p90_us": 156.875, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5133450907022585}, {"baseline_us": 205.39600000000002, "gbps_est": 0.6716559139784947, "latency_us": 151.125, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 142.041, "p90_us": 160.25, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.3591133167907363}], "reference_latency_us": 211.52100000000002, "speedup_vs_ref": 1.463387804236831}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": null, "seed": 0, "status": "benchmarked", "step": 0, "template_params": {"use_fma": false}, "ts": "2026-02-09T19:12:14-0600"}
{"candidate_id": "rope_faa2cc8c9f591b70", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.125}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg128_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 128}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.038334, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.43031724585328224, "latency_us": 140.29149999999998, "p10_us": 128.458, "p90_us": 166.125, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.16827140634651144, "latency_us": 151.3745, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 134.458, "p90_us": 161.5, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5214748851358715}, {"baseline_us": 211.52100000000002, "gbps_est": 0.3817752217242843, "latency_us": 133.1045, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 123.083, "p90_us": 165.083, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5891348526909308}, {"baseline_us": 205.39600000000002, "gbps_est": 0.7409051094890511, "latency_us": 137.0, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 130.667, "p90_us": 166.125, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.499240875912409}], "reference_latency_us": 211.52100000000002, "speedup_vs_ref": 1.5077249869022715}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_da5cfefdaee0904b", "seed": 0, "status": "benchmarked", "step": 0, "template_params": {"use_fma": true}, "ts": "2026-02-09T19:12:14-0600"}
{"candidate_id": "rope_d8bd5f5b96766e89", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.125}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg128_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 128}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.027333, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.4474475541627978, "latency_us": 132.375, "p10_us": 125.583, "p90_us": 142.083, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.1952812649736464, "latency_us": 130.4375, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 123.333, "p90_us": 138.625, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.7656923814087206}, {"baseline_us": 211.52100000000002, "gbps_est": 0.37024408014571947, "latency_us": 137.25, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 123.208, "p90_us": 142.083, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5411366120218581}, {"baseline_us": 205.39600000000002, "gbps_est": 0.7768173173690275, "latency_us": 130.66649999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 126.292, "p90_us": 135.959, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5719101682527659}], "reference_latency_us": 211.52100000000002, "speedup_vs_ref": 1.5978923512747876}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_faa2cc8c9f591b70", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": false}, "ts": "2026-02-09T19:12:14-0600"}
{"candidate_id": "rope_5e49a0eb05882163", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.5}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg512_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 512}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.030792, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.45621976193941166, "latency_us": 130.58350000000002, "p10_us": 127.541, "p90_us": 193.541, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.19318336948442977, "latency_us": 131.85399999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 126.583, "p90_us": 135.125, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.7467236488843723}, {"baseline_us": 211.52100000000002, "gbps_est": 0.39405077622171564, "latency_us": 128.958, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 127.25, "p90_us": 140.5, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6402317033452753}, {"baseline_us": 205.39600000000002, "gbps_est": 0.7814251401120896, "latency_us": 129.89600000000002, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 127.916, "p90_us": 204.125, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5812342181437458}], "reference_latency_us": 211.52100000000002, "speedup_vs_ref": 1.6198141419091998}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_81f50de3ebb400a3", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": false}, "ts": "2026-02-09T19:12:14-0600"}
{"candidate_id": "rope_8e6b355277070755", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.0625}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg64_fma0", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 64}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = false;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.02575, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.4541913916364391, "latency_us": 130.458, "p10_us": 123.291, "p90_us": 186.125, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.18383040144339197, "latency_us": 138.5625, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 128.833, "p90_us": 171.083, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6621560667568787}, {"baseline_us": 211.52100000000002, "gbps_est": 0.40537996394211595, "latency_us": 125.354, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 120.916, "p90_us": 130.375, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6873893134642692}, {"baseline_us": 205.39600000000002, "gbps_est": 0.7733638095238096, "latency_us": 131.25, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 126.667, "p90_us": 192.083, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.564921904761905}], "reference_latency_us": 211.52100000000002, "speedup_vs_ref": 1.621372395713563}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_faa2cc8c9f591b70", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": false}, "ts": "2026-02-09T19:12:14-0600"}
{"candidate_id": "rope_c73769625b5efd6b", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.25}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg256_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 256}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.028083, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.45318558499742756, "latency_us": 131.333, "p10_us": 124.667, "p90_us": 140.667, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.18245895533079284, "latency_us": 139.60399999999998, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 136.917, "p90_us": 142.792, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.649755737657947}, {"baseline_us": 211.52100000000002, "gbps_est": 0.3925258189851613, "latency_us": 129.459, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 126.25, "p90_us": 130.708, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.633884086853753}, {"baseline_us": 205.39600000000002, "gbps_est": 0.7845719806763285, "latency_us": 129.375, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 119.166, "p90_us": 134.417, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.58760193236715}], "reference_latency_us": 211.52100000000002, "speedup_vs_ref": 1.6105700775890295}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_da5cfefdaee0904b", "seed": 0, "status": "benchmarked", "step": 1, "template_params": {"use_fma": true}, "ts": "2026-02-09T19:12:14-0600"}
{"candidate_id": "rope_981b7e3c51434fe4", "event": "evaluation", "features": {"arithmetic_intensity_est": 0.3316582914572864, "bytes_moved_est": 25472.0, "launch_occupancy_proxy": 0.0625}, "func_name": "kk_kd_rope_dn128_dr64_hq32_tg64_fma1", "inputs_spec": [{"dtype": "float16", "name": "q_nope", "shape": [1, 32, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "q_rope", "shape": [1, 32, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "kv_nope", "shape": [1, 1, 1, 128], "strides": "contiguous"}, {"dtype": "float16", "name": "k_rope", "shape": [1, 1, 1, 64], "strides": "contiguous"}, {"dtype": "float16", "name": "cos", "shape": [32], "strides": "contiguous"}, {"dtype": "float16", "name": "sin", "shape": [32], "strides": "contiguous"}], "launch_params": {"launch_kind": "rope_decode_pos", "threadgroup_x": 64}, "metal_source": "constexpr uint D_NOPE = 128;\nconstexpr uint D_ROPE = 64;\nconstexpr uint HALF = D_ROPE / 2;\nconstexpr uint D_OUT = D_NOPE + D_ROPE;\nconstexpr uint H_Q = 32;\nconstexpr bool USE_FMA = true;\n\nconstexpr uint Q_ELEMS_PER_BATCH = H_Q * D_OUT;\nconstexpr uint K_ELEMS_PER_BATCH = D_OUT;\nconstexpr uint ELEMS_PER_BATCH = Q_ELEMS_PER_BATCH + K_ELEMS_PER_BATCH;\n\nuint gid = thread_position_in_grid.x;\nuint batch = gid / ELEMS_PER_BATCH;\nuint in_batch = gid - batch * ELEMS_PER_BATCH;\n\nif (in_batch < Q_ELEMS_PER_BATCH) {\n    uint head = in_batch / D_OUT;\n    uint col = in_batch - head * D_OUT;\n\n    uint q_out_base = (batch * H_Q + head) * D_OUT;\n\n    if (col < D_NOPE) {\n        uint q_nope_base = (batch * H_Q + head) * D_NOPE;\n        q_out[q_out_base + col] = q_nope[q_nope_base + col];\n        return;\n    }\n\n    uint r = col - D_NOPE;\n    uint pair = r / 2;\n    float c = (float)cos[pair];\n    float s = (float)sin[pair];\n\n    uint q_rope_base = (batch * H_Q + head) * D_ROPE;\n    if ((r & 1u) == 0u) {\n        float a = (float)q_rope[q_rope_base + r];\n        float b = (float)q_rope[q_rope_base + r + 1];\n        float rotated = USE_FMA ? fma(-b, s, a * c) : (a * c - b * s);\n        q_out[q_out_base + col] = (T)rotated;\n    } else {\n        float a = (float)q_rope[q_rope_base + r - 1];\n        float b = (float)q_rope[q_rope_base + r];\n        float rotated = USE_FMA ? fma(b, c, a * s) : (a * s + b * c);\n        q_out[q_out_base + col] = (T)rotated;\n    }\n    return;\n}\n\nuint k_col = in_batch - Q_ELEMS_PER_BATCH;\nuint k_out_base = batch * D_OUT;\nif (k_col < D_NOPE) {\n    uint kv_nope_base = batch * D_NOPE;\n    k_out[k_out_base + k_col] = kv_nope[kv_nope_base + k_col];\n    return;\n}\n\nuint kr = k_col - D_NOPE;\nuint kpair = kr / 2;\nfloat kc = (float)cos[kpair];\nfloat ks = (float)sin[kpair];\nuint k_rope_base = batch * D_ROPE;\nif ((kr & 1u) == 0u) {\n    float a = (float)k_rope[k_rope_base + kr];\n    float b = (float)k_rope[k_rope_base + kr + 1];\n    float rotated = USE_FMA ? fma(-b, ks, a * kc) : (a * kc - b * ks);\n    k_out[k_out_base + k_col] = (T)rotated;\n} else {\n    float a = (float)k_rope[k_rope_base + kr - 1];\n    float b = (float)k_rope[k_rope_base + kr];\n    float rotated = USE_FMA ? fma(b, kc, a * ks) : (a * ks + b * kc);\n    k_out[k_out_base + k_col] = (T)rotated;\n}\n", "metrics": {"compile_time_ms": 0.024833, "correctness_max_abs_err": 0.0, "correctness_max_rel_err": 0.0, "dtype": "float16", "gbps_est": 0.45899049275424814, "latency_us": 129.063, "p10_us": 122.583, "p90_us": 160.167, "per_shape": [{"baseline_us": 230.3125, "gbps_est": 0.19603270803270803, "latency_us": 129.9375, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 122.583, "p90_us": 134.166, "shape": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.7724867724867726}, {"baseline_us": 211.52100000000002, "gbps_est": 0.397, "latency_us": 128.0, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 126.625, "p90_us": 131.708, "shape": {"B": 2, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.6525078125000001}, {"baseline_us": 205.39600000000002, "gbps_est": 0.7839387702300363, "latency_us": 129.4795, "max_abs_err": 0.0, "max_rel_err": 0.0, "p10_us": 118.084, "p90_us": 160.167, "shape": {"B": 4, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "speedup_vs_ref": 1.5863206144602042}], "reference_latency_us": 211.52100000000002, "speedup_vs_ref": 1.6388972827223915}, "notes": {"dtype": "float16", "shape_signature": {"B": 1, "D_NOPE": 128, "D_OUT": 192, "D_ROPE": 64, "H_Q": 32}, "shape_suite": "glm_flash_small"}, "op_name": "rope", "outputs_spec": [{"dtype": "float16", "name": "q_out", "shape": [1, 32, 1, 192], "strides": "contiguous"}, {"dtype": "float16", "name": "k_out", "shape": [1, 1, 1, 192], "strides": "contiguous"}], "parent_id": "rope_d8bd5f5b96766e89", "seed": 0, "status": "benchmarked", "step": 2, "template_params": {"use_fma": true}, "ts": "2026-02-09T19:12:14-0600"}
